!function(){"use strict";const t=5,e=7,i=8,n=17,s="ChromePush",a="SafariPush",o="SafariLegacyPush",r="FirefoxPush",c=-20,u=-21,l=-22,d="chrome",f="safari",p="firefox",w="other",h=[{t:"Opera",l:/(?:opera|opr|opios)/i,h:/(?:opera|opr|opios)[ /](\d+(?:\.\d+)?)/i},{t:"Facebook",l:/FBAN\//i,h:/FBAV\/(\d+(?:\.\d+)?)/i},{t:"Samsung Browser",l:/samsungbrowser/i,h:/samsungbrowser[ /](\d+(?:\.\d+)?)/i},{t:"Yandex Browser",l:/yabrowser/i,h:/yabrowser[ /](\d+(?:\.\d+)?)/i},{t:"Vivaldi",l:/vivaldi/i,h:/vivaldi[ /](\d+(?:\.\d+)?)/i},{t:"UC Browser",l:/ucbrowser/i,h:/ucbrowser[ /](\d+(?:\.\d+)?)/i},{t:"Microsoft Edge",l:/edg/i,h:/edg[ /](\d+(?:\.\d+)?)/i},{t:"Firefox",l:/firefox|iceweasel|fxios/i,h:/(?:firefox|iceweasel|fxios)[ /](\d+(?:\.\d+)?)/i},{t:"Chromium",l:/chromium/i,h:/chromium[ /](\d+(?:\.\d+)?)/i},{t:"Chrome",l:/chrome|crios|crmo/i,h:/(?:chrome|crios|crmo)[ /](\d+(?:\.\d+)?)/i},{t:"Safari",l:/safari|applewebkit/i,h:/version[ /](\d+(?:\.\d+)?)/i}];const b={Chrome:d,Chromium:d,Firefox:p,"Microsoft Edge":"edge",Safari:f};function y(){return b[function(t){for(const e of h)if(e.l.test(t)){const i=t.match(e.h)?.[1]??"";return{name:e.t,version:i}}return{name:"Unknown",version:""}}(navigator.userAgent).name]||w}const m="160507",g="undefined"!=typeof window,v=()=>g&&null!=window.safari?.pushNotification,_="undefined"!=typeof PushSubscriptionOptions&&PushSubscriptionOptions.prototype.hasOwnProperty("applicationServerKey"),S=()=>y()===p?r:y()===f&&_&&!v()?a:v()?o:s;function k(){switch(S()){case r:return i;case o:return e;case a:return n}return t}const I=new Error("Missing app ID"),P=new Error("Retry limit reached"),O=new Error("Permission blocked"),D=new Error("AppID doesn't match existing apps");function C(t){return new Promise(e=>setTimeout(e,t))}function x(t,e){return null!=t?t:e}function T(t){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/.test(t)}class N{static m(){return!!self.shouldLog}static v(t){}static _(t){return(...e)=>{(this.m()||"error"===t)&&console[t](...e)}}static S=N._("debug");static k=N._("info");static I=N._("warn");static P=N._("error")}const B={5:1e4,4:2e4,3:3e4,2:3e4,1:3e4};class U{static get(t,e,i){return U.call("GET",t,e,i)}static post(t,e,i){return U.call("POST",t,e,i)}static put(t,e,i){return U.call("PUT",t,e,i)}static delete(t,e,i){return U.call("DELETE",t,e,i)}static patch(t,e,i){return U.call("PATCH",t,e,i)}static call(t,e,i,n){if(!this.O(e,i))return Promise.reject(I);const s=new Headers;if(s.append("Origin",self.location.origin),s.append("SDK-Version",`onesignal/web/${m}`),s.append("Content-Type","application/json;charset=UTF-8"),s.append("Accept","application/vnd.onesignal.v1+json"),n)for(const r of Object.keys(n))s.append(r,n[r]);const a={method:t||"NO_METHOD_SPECIFIED",headers:s,cache:"no-cache"};i&&(a.body=JSON.stringify(i));const o=`${(({action:t,legacy:e=!1}={})=>new URL(e?"https://onesignal.com/api/v1/":"https://api.onesignal.com/"))({action:e}).toString()}${e}`;return U.executeFetch(o,a)}static async executeFetch(t,e,i=5){if(0===i)return Promise.reject(P);try{const i=await fetch(t,e),{status:n,headers:s}=i,a=await i.json(),o=s?.get("Retry-After");return{ok:i.ok,result:a,status:n,retryAfterSeconds:o?parseInt(o):void 0}}catch(n){if(n instanceof Error&&"TypeError"===n.name)return await C(B[i]),N.P(`OneSignal: Network timed out while calling ${t}. Retrying...`),U.executeFetch(t,e,i-1);throw new Error(`Failed to execute HTTP call: ${n}`)}}static O(t,e){if(t.startsWith("apps/")){return T(t.split("/")[1])}if(t.startsWith("sync/")){return T(t.split("/")[1])}return!(!e||"string"!=typeof e.app_id)&&T(e.app_id)}}const A="onesignal_id";function M(t){return encodeURIComponent(t).replace(/[!'()*]/g,t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`)}async function R(t,e,i){const{appId:n,subscriptionId:s}=t;if(!T(n))throw D;const a=s?{"OneSignal-Subscription-Id":s}:void 0;let o={};a&&(o={...o,...a}),t.jwtHeader&&(o={...o,...t.jwtHeader});const r=M(e.label),c=M(e.id);return U.patch(`apps/${n}/users/by/${r}/${c}`,i,o)}function E(t){if(!t)throw new Error("App id cannot be empty")}const $=1,W=2,F=3,K=4;class L{static async sendOutcome(t){N.k("Outcome payload:",t);try{await U.post("outcomes/measure",t)}catch(e){N.P("sendOutcome",e)}}}class V{static async D(t){E(t);const e=await U.get(`sync/${t}/web`,null);return e?.result}static C(t,e,i){return E(t),U.post("players",{app_id:t,device_type:e,identifier:i,notification_types:c}).then(t=>t?.result?.id?t.result.id:null).catch(t=>(N.S("Error getting user ID from subscription identifier:",t),null))}static async T(t,e,i){const n={label:A,id:e},s={refresh_device_metadata:!0,deltas:{session_count:1}};E(t),function(t){if(!t.id)throw new Error("Alias id cannot be empty")}(n);try{await R({appId:t,subscriptionId:i},n,s)}catch(a){N.S("Error updating user session:",a)}}static async N(t,e,i,n,s){const a={refresh_device_metadata:!0,deltas:{session_time:n}},o={label:A,id:e},r={id:"os__session_duration",app_id:t,session_time:n,notification_ids:s.notificationIds,subscription:{id:i,type:S()},onesignal_id:e};r.direct=s.type===$;try{await R({appId:t,subscriptionId:i},o,a),r.notification_ids&&r.notification_ids.length>0&&await L.sendOutcome(r)}catch(c){N.S("Error sending session duration:",c)}}}const H={scope:"/"},j="push",z="category",q={pageViews:1,timeDelay:0},J="We'd like to show you notifications for the latest news and updates.",G="Allow",Y="Cancel",X={updateMessage:"Update your push notification subscription preferences.",positiveUpdateButton:"Save Preferences",negativeUpdateButton:"Cancel"},Q="Thank You!",Z={type:j,text:{actionMessage:J,acceptButton:G,cancelButton:Y},autoPrompt:!1,delay:q},tt="wordpress",et="custom";function it(t){const e=t.config.staticPrompts,i=e.native?{enabled:e.native.enabled,autoPrompt:e.native.enabled&&!1!==e.native.autoPrompt,pageViews:x(e.native.pageViews,q.pageViews),timeDelay:x(e.native.timeDelay,q.timeDelay)}:{enabled:!1,autoPrompt:!1,pageViews:q.pageViews,timeDelay:q.timeDelay},{prompts:n}=e.slidedown;return{autoPrompt:i.autoPrompt||nt(n),native:i,slidedown:{prompts:n},fullscreen:{enabled:e.fullscreen.enabled,actionMessage:e.fullscreen.actionMessage,acceptButton:e.fullscreen.acceptButton,cancelButton:e.fullscreen.cancelButton,title:e.fullscreen.title,message:e.fullscreen.message,caption:e.fullscreen.caption,autoAcceptTitle:e.fullscreen.autoAcceptTitle},customlink:st(t)}}function nt(t){if(!t)return!1;for(let e=0;e<t.length;e++)if(t[e].autoPrompt)return!0;return!1}function st(t){const e={enabled:!1,style:"button",size:"medium",unsubscribeEnabled:!1,text:{explanation:"",subscribe:"",unsubscribe:""},color:{button:"",text:""}};if(!(t&&t.config&&t.config.staticPrompts&&t.config.staticPrompts.customlink&&t.config.staticPrompts.customlink.enabled))return e;const i=t.config.staticPrompts.customlink;return{enabled:i.enabled,style:i.style,size:i.size,unsubscribeEnabled:i.unsubscribeEnabled,text:i.text?{subscribe:i.text.subscribe,unsubscribe:i.text.unsubscribe,explanation:i.text.explanation}:e.text,color:i.color?{button:i.color.button,text:i.color.text}:e.color}}const at=0,ot=1;function rt(t){switch(t){case et:case tt:return{configuration:ot};default:return{configuration:at}}}function ct(t,e,i){switch(rt(t).configuration){case at:{const{path:t,serviceWorkerPath:n,serviceWorkerParam:s}=function(t,e){const{serviceWorker:i}=e.config,n=t.serviceWorkerOverrideForTypical;return{path:n?x(t.path,i.path):i.path,serviceWorkerParam:n?x(t.serviceWorkerParam,{scope:i.registrationScope}):{scope:i.registrationScope},serviceWorkerPath:n?x(t.serviceWorkerPath,i.workerName):i.workerName}}(e,i);return{appId:i.app_id,autoRegister:!1,autoResubscribe:i.config.autoResubscribe,path:t,serviceWorkerPath:n,serviceWorkerParam:s,subdomainName:i.config.siteInfo.proxyOrigin,promptOptions:it(i),welcomeNotification:{disable:!i.config.welcomeNotification.enable,title:i.config.welcomeNotification.title,message:i.config.welcomeNotification.message,url:i.config.welcomeNotification.url},notifyButton:{enable:i.config.staticPrompts.bell.enabled,displayPredicate:null,size:i.config.staticPrompts.bell.size,position:i.config.staticPrompts.bell.location,showCredit:!1,offset:{bottom:`${i.config.staticPrompts.bell.offset.bottom}px`,left:`${i.config.staticPrompts.bell.offset.left}px`,right:`${i.config.staticPrompts.bell.offset.right}px`},colors:{"circle.background":i.config.staticPrompts.bell.color.main,"circle.foreground":i.config.staticPrompts.bell.color.accent,"badge.background":"black","badge.foreground":"white","badge.bordercolor":"black","pulse.color":i.config.staticPrompts.bell.color.accent,"dialog.button.background.hovering":i.config.staticPrompts.bell.color.main,"dialog.button.background.active":i.config.staticPrompts.bell.color.main,"dialog.button.background":i.config.staticPrompts.bell.color.main,"dialog.button.foreground":"white"},text:{"tip.state.unsubscribed":i.config.staticPrompts.bell.tooltip.unsubscribed,"tip.state.subscribed":i.config.staticPrompts.bell.tooltip.subscribed,"tip.state.blocked":i.config.staticPrompts.bell.tooltip.blocked,"message.prenotify":i.config.staticPrompts.bell.tooltip.unsubscribed,"message.action.subscribing":i.config.staticPrompts.bell.message.subscribing,"message.action.subscribed":i.config.staticPrompts.bell.message.subscribing,"message.action.resubscribed":i.config.staticPrompts.bell.message.subscribing,"message.action.unsubscribed":i.config.staticPrompts.bell.message.unsubscribing,"dialog.main.title":i.config.staticPrompts.bell.dialog.main.title,"dialog.main.button.subscribe":i.config.staticPrompts.bell.dialog.main.subscribeButton,"dialog.main.button.unsubscribe":i.config.staticPrompts.bell.dialog.main.unsubscribeButton,"dialog.blocked.title":i.config.staticPrompts.bell.dialog.blocked.title,"dialog.blocked.message":i.config.staticPrompts.bell.dialog.blocked.message}},persistNotification:i.config.notificationBehavior?i.config.notificationBehavior.display.persist:void 0,webhooks:{cors:i.config.webhooks.corsEnable,"notification.willDisplay":i.config.webhooks.notificationDisplayedHook,"notification.clicked":i.config.webhooks.notificationClickedHook,"notification.dismissed":i.config.webhooks.notificationDismissedHook},notificationClickHandlerMatch:i.config.notificationBehavior?i.config.notificationBehavior.click.match:void 0,notificationClickHandlerAction:i.config.notificationBehavior?i.config.notificationBehavior.click.action:void 0,outcomes:{direct:i.config.outcomes.direct,indirect:{enabled:i.config.outcomes.indirect.enabled,influencedTimePeriodMin:i.config.outcomes.indirect.notification_attribution.minutes_since_displayed,influencedNotificationsLimit:i.config.outcomes.indirect.notification_attribution.limit},unattributed:i.config.outcomes.unattributed}}}case ot:{const t={...e,promptOptions:ut(e.promptOptions,i.config.staticPrompts,e),serviceWorkerParam:e.serviceWorkerParam?e.serviceWorkerParam:H,serviceWorkerPath:e.serviceWorkerPath?e.serviceWorkerPath:"OneSignalSDKWorker.js",path:e.path?e.path:"/",outcomes:{direct:i.config.outcomes.direct,indirect:{enabled:i.config.outcomes.indirect.enabled,influencedTimePeriodMin:i.config.outcomes.indirect.notification_attribution.minutes_since_displayed,influencedNotificationsLimit:i.config.outcomes.indirect.notification_attribution.limit},unattributed:i.config.outcomes.unattributed}};return Object.prototype.hasOwnProperty.call(e,"autoResubscribe")?t.autoResubscribe=!!e.autoResubscribe:Object.prototype.hasOwnProperty.call(e,"autoRegister")?t.autoResubscribe=!!e.autoRegister:t.autoResubscribe=!!i.config.autoResubscribe,t}}}function ut(t,e,i){let n={enabled:!1};t&&t.customlink&&(n=t.customlink);const s=e.customlink,a={...t,customlink:{enabled:x(n.enabled,s.enabled),style:x(n.style,s.style),size:x(n.size,s.size),unsubscribeEnabled:x(n.unsubscribeEnabled,s.unsubscribeEnabled),text:{subscribe:x(n.text?n.text.subscribe:void 0,s.text.subscribe),unsubscribe:x(n.text?n.text.unsubscribe:void 0,s.text.unsubscribe),explanation:x(n.text?n.text.explanation:void 0,s.text.explanation)},color:{button:x(n.color?n.color.button:void 0,s.color.button),text:x(n.color?n.color.text:void 0,s.color.text)}}};if(a.slidedown?a.slidedown.prompts=a.slidedown?.prompts?.map(t=>{if(t.type=x(t.type,j),t.type===z&&(t.text={...t.text,positiveUpdateButton:x(t.text?.positiveUpdateButton,X.positiveUpdateButton),negativeUpdateButton:x(t.text?.negativeUpdateButton,X.negativeUpdateButton),updateMessage:x(t.text?.updateMessage,X.updateMessage)}),t.text={...t.text,actionMessage:x(t.text?.actionMessage,J),acceptButton:x(t.text?.acceptButton,G),cancelButton:x(t.text?.cancelButton,Y),confirmMessage:x(t.text?.confirmMessage,Q)},t.autoPrompt=x(t.autoPrompt,!0),t.delay={pageViews:x(t.delay?.pageViews,q.pageViews),timeDelay:x(t.delay?.timeDelay,q.timeDelay)},t.categories){const{categories:i}=t;t.categories=(e=10,structuredClone(i).slice(0,e))}var e;return t}):(a.slidedown={prompts:[]},a.slidedown.prompts=[Z]),a.native){const t=Object.prototype.hasOwnProperty.call(a.native,"autoPrompt");a.native.autoPrompt=t?!!a.native.enabled&&!!a.native.autoPrompt:!!a.native.enabled,a.native.enabled=!!a.native.enabled,a.native.pageViews=x(a.native.pageViews,q.pageViews),a.native.timeDelay=x(a.native.timeDelay,q.timeDelay)}else a.native={enabled:!1,autoPrompt:!1,pageViews:q.pageViews,timeDelay:q.timeDelay};return!0===i.autoRegister&&(a.native.enabled=!0,a.native.autoPrompt=!0),a.autoPrompt=a.native.autoPrompt||nt(a.slidedown.prompts),a}function lt(t){(function(t){if(!t)return!1;return["acceptButtonText","cancelButtonText","actionMessage"].some(e=>Object.prototype.hasOwnProperty.call(t,e))})(t.promptOptions)&&(t.promptOptions=function(t){t.slidedown||(t.slidedown={});const{slidedown:e}=t;return e.acceptButtonText=e.acceptButtonText??t.acceptButtonText??t.acceptButton,e.cancelButtonText=e.cancelButtonText??t.cancelButtonText??t.cancelButton,e.actionMessage=e.actionMessage??t.actionMessage,t}(t.promptOptions)),function(t){if(!t)return!1;return["enabled","autoPrompt","pageViews","timeDelay","acceptButton","acceptButtonText","cancelButton","cancelButtonText","actionMessage","customizeTextEnabled","categories"].some(e=>Object.prototype.hasOwnProperty.call(t,e))}(t.promptOptions?.slidedown)&&t.promptOptions?.slidedown&&(t.promptOptions.slidedown=function(t){const e=(o=t,(o?.categories?.tags?.length||0)>0),i=e?z:j,{categories:n,prompts:s=[]}=t,a={type:i,autoPrompt:t.autoPrompt,text:{actionMessage:t.actionMessage,acceptButton:t.acceptButton??t.acceptButtonText,cancelButton:t.cancelButton??t.cancelButtonText,...e&&{positiveUpdateButton:n?.positiveUpdateButton,negativeUpdateButton:n?.negativeUpdateButton,updateMessage:n?.updateMessage}},delay:{pageViews:t.pageViews,timeDelay:t.timeDelay},categories:n?.tags};var o;return{prompts:[...s,a]}}(t.promptOptions?.slidedown))}const dt=30,ft=!1,pt=!0;async function wt(t,e){try{if(!t||!t.appId||!T(t.appId))throw D;const i=await e(t.appId);lt(t);const n=function(t,e){const i=function(t){return t.config.integration?.kind??et}(e),n=function(t,e,i){switch(rt(t).configuration){case at:return i.config.siteInfo.proxyOriginEnabled;case ot:return!!e.subdomainName}}(i,t,e),s=ct(i,t,e);return{appId:e.app_id,hasUnsupportedSubdomain:n,siteName:e.config.siteInfo.name,origin:e.config.origin,restrictedOriginEnabled:e.features.restrict_origin&&e.features.restrict_origin.enable,safariWebId:e.config.safari_web_id,vapidPublicKey:e.config.vapid_public_key,onesignalVapidPublicKey:e.config.onesignal_vapid_public_key,userConfig:s,enableOnSession:x(e.features.enable_on_session,ft),sessionThreshold:x(e.features.session_threshold,dt),enableSessionDuration:x(e.features.web_on_focus_enabled,pt)}}(t,i);return function(t){const e=!self.isSecureContext;if(t.hasUnsupportedSubdomain||e)throw e?new Error("OneSignalSDK: HTTP sites are no longer supported starting with version 16 (User Model), your public site must start with https://."):new Error('OneSignalSDK: The "My site is not fully HTTPS" option is no longer supported starting with version 16 (User Model) of the OneSignal SDK.')}(n),n}catch(i){if(i instanceof Object&&"code"in i){if(1===i.code)throw D;if(2===i.code)throw new Error("App not configured for web push")}throw i}}const ht=(t,e)=>e.some(e=>t instanceof e);let bt,yt;const mt=new WeakMap,gt=new WeakMap,vt=new WeakMap;let _t={get(t,e,i){if(t instanceof IDBTransaction){if("done"===e)return mt.get(t);if("store"===e)return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return Pt(t[e])},set:(t,e,i)=>(t[e]=i,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function St(t){_t=t(_t)}function kt(t){return(yt||(yt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(Ot(this),e),Pt(this.request)}:function(...e){return Pt(t.apply(Ot(this),e))}}function It(t){return"function"==typeof t?kt(t):(t instanceof IDBTransaction&&function(t){if(mt.has(t))return;const e=new Promise((e,i)=>{const n=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",a),t.removeEventListener("abort",a)},s=()=>{e(),n()},a=()=>{i(t.error||new DOMException("AbortError","AbortError")),n()};t.addEventListener("complete",s),t.addEventListener("error",a),t.addEventListener("abort",a)});mt.set(t,e)}(t),ht(t,bt||(bt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,_t):t)}function Pt(t){if(t instanceof IDBRequest)return function(t){const e=new Promise((e,i)=>{const n=()=>{t.removeEventListener("success",s),t.removeEventListener("error",a)},s=()=>{e(Pt(t.result)),n()},a=()=>{i(t.error),n()};t.addEventListener("success",s),t.addEventListener("error",a)});return vt.set(e,t),e}(t);if(gt.has(t))return gt.get(t);const e=It(t);return e!==t&&(gt.set(t,e),vt.set(e,t)),e}const Ot=t=>vt.get(t);const Dt=["get","getKey","getAll","getAllKeys","count"],Ct=["put","add","delete","clear"],xt=new Map;function Tt(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(xt.get(e))return xt.get(e);const i=e.replace(/FromIndex$/,""),n=e!==i,s=Ct.includes(i);if(!(i in(n?IDBIndex:IDBObjectStore).prototype)||!s&&!Dt.includes(i))return;const a=async function(t,...e){const a=this.transaction(t,s?"readwrite":"readonly");let o=a.store;return n&&(o=o.index(e.shift())),(await Promise.all([o[i](...e),s&&a.done]))[0]};return xt.set(e,a),a}St(t=>({...t,get:(e,i,n)=>Tt(e,i)||t.get(e,i,n),has:(e,i)=>!!Tt(e,i)||t.has(e,i)}));const Nt=["continue","continuePrimaryKey","advance"],Bt={},Ut=new WeakMap,At=new WeakMap,Mt={get(t,e){if(!Nt.includes(e))return t[e];let i=Bt[e];return i||(i=Bt[e]=function(...t){Ut.set(this,At.get(this)[e](...t))}),i}};async function*Rt(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;const i=new Proxy(e,Mt);for(At.set(i,e),vt.set(i,Ot(e));e;)yield i,e=await(Ut.get(i)||e.continue()),Ut.delete(i)}function Et(t,e){return e===Symbol.asyncIterator&&ht(t,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===e&&ht(t,[IDBIndex,IDBObjectStore])}St(t=>({...t,get:(e,i,n)=>Et(e,i)?Rt:t.get(e,i,n),has:(e,i)=>Et(e,i)||t.has(e,i)}));const $t="oneSignalSession",Wt="active",Ft="inactive",Kt=1;let Lt=!1;const Vt=async(t=7)=>function(t,e,{blocked:i,upgrade:n,blocking:s,terminated:a}={}){const o=indexedDB.open(t,e),r=Pt(o);return n&&o.addEventListener("upgradeneeded",t=>{n(Pt(o.result),t.oldVersion,t.newVersion,Pt(o.transaction),t)}),i&&o.addEventListener("blocked",t=>i(t.oldVersion,t.newVersion,t)),r.then(t=>{a&&t.addEventListener("close",()=>a()),s&&t.addEventListener("versionchange",t=>s(t.oldVersion,t.newVersion,t))}).catch(()=>{}),r}("ONE_SIGNAL_SDK_DB",t,{upgrade(e,i,n,s){const a=n||t;a>=1&&i<1&&(e.createObjectStore("Ids",{keyPath:"type"}),e.createObjectStore("NotificationOpened",{keyPath:"url"}),e.createObjectStore("Options",{keyPath:"key"})),a>=2&&i<2&&(e.createObjectStore("Sessions",{keyPath:"sessionKey"}),e.createObjectStore("NotificationReceived",{keyPath:"notificationId"}),e.createObjectStore("NotificationClicked",{keyPath:"notificationId"})),a>=3&&i<3&&e.createObjectStore("SentUniqueOutcome",{keyPath:"outcomeName"}),a>=4&&i<4&&(e.createObjectStore("identity",{keyPath:"modelId"}),e.createObjectStore("properties",{keyPath:"modelId"}),e.createObjectStore("pushSubscriptions",{keyPath:"modelId"}),e.createObjectStore("smsSubscriptions",{keyPath:"modelId"}),e.createObjectStore("emailSubscriptions",{keyPath:"modelId"})),a>=5&&i<5&&(async function(t,e){const i="NotificationClicked",n="Outcomes.NotificationClicked";t.createObjectStore(n,{keyPath:"notificationId"});let s=await e.objectStore(i).openCursor();for(;s;){const t=s.value;await e.objectStore(n).put({notificationId:t.notificationId||t.notification.id,appId:t.appId,timestamp:t.timestamp}),s=await s.continue()}t.deleteObjectStore(i)}(e,s),async function(t,e){const i="NotificationReceived",n="Outcomes.NotificationReceived";t.createObjectStore(n,{keyPath:"notificationId"});let s=await e.objectStore(i).openCursor();for(;s;)await e.objectStore(n).put(s.value),s=await s.continue();t.deleteObjectStore(i)}(e,s)),a>=6&&i<6&&async function(t,e){const i="subscriptions";let n;t.createObjectStore(i,{keyPath:"modelId"});const s=await e.objectStore("identity").getAll();s.length>0&&(n=s[0].externalId);for(const a of["emailSubscriptions","pushSubscriptions","smsSubscriptions"]){let s=await e.objectStore(a).openCursor();for(;s;)await e.objectStore(i).put({...s.value,modelName:"subscriptions",externalId:n}),s=await s.continue();t.deleteObjectStore(a)}}(e,s),a>=7&&i<7&&e.createObjectStore("operations",{keyPath:"modelId"}),Lt=!1},blocked(){N.S("IndexedDB: Blocked event")},terminated(){Lt||(Lt=!0,jt())}});let Ht=Vt();const jt=(t=7)=>(Ht=Vt(t),Ht),zt={get:async(t,e)=>(await Ht).get(t,e),getAll:async t=>(await Ht).getAll(t),put:async(t,e)=>(await Ht).put(t,e),delete:async(t,e)=>(await Ht).delete(t,e)},qt=async t=>(await Ht).clear(t),Jt=async t=>{const e=await zt.get("Options",t);return e&&"value"in e?e.value:null},Gt=async()=>await zt.get("Sessions",$t)??null,Yt=async()=>{await zt.delete("Sessions",$t)},Xt=async()=>{const t={},e=await(async t=>{const e=await zt.get("Ids",t);return e&&"id"in e?e.id:null})("appId");return t.appId=e,t.vapidPublicKey=await Jt("vapidPublicKey"),t};const Qt=async(t,e)=>{await zt.put("Outcomes.NotificationReceived",function(t,e,i){return{appId:t,notificationId:e.notificationId,timestamp:i}}(t,e,Date.now()))},Zt=async()=>(await zt.getAll("Outcomes.NotificationClicked")).map(t=>{return{appId:(e=t).appId,notificationId:e.notificationId,timestamp:e.timestamp};var e});class te{deviceId;subscriptionToken;optedOut;createdAt;expirationTime;B(){return{deviceId:this.deviceId,subscriptionToken:this.subscriptionToken,optedOut:this.optedOut,createdAt:this.createdAt,expirationTime:this.expirationTime}}static deserialize(t){const e=new te;return e.deviceId=t.deviceId,e.subscriptionToken=t.subscriptionToken,e.optedOut=t.optedOut,e.createdAt=t.createdAt,e.expirationTime=t.expirationTime,e}}const ee=async()=>{const t=new te;t.deviceId=(await zt.get("Ids","userId"))?.id,t.subscriptionToken=(await zt.get("Ids","registrationId"))?.id;const e=await Jt("optedOut"),i=await Jt("subscription"),n=await Jt("subscriptionCreatedAt"),s=await Jt("subscriptionExpirationTime");return t.optedOut=null!=e?e:null!=i&&!i,t.createdAt=n??null,t.expirationTime=s??null,t},ie=async t=>{t.deviceId&&await zt.put("Ids",{type:"userId",id:t.deviceId}),void 0!==t.subscriptionToken&&await zt.put("Ids",{type:"registrationId",id:t.subscriptionToken}),null!=t.optedOut&&await zt.put("Options",{key:"optedOut",value:t.optedOut}),null!=t.createdAt&&await zt.put("Options",{key:"subscriptionCreatedAt",value:t.createdAt}),null!=t.expirationTime?await zt.put("Options",{key:"subscriptionExpirationTime",value:t.expirationTime}):await zt.delete("Options","subscriptionExpirationTime")};function ne(t,e){const i=1e3*e;let n,s=()=>{};return{promise:new Promise((e,a)=>{let o=!1;n=self.setTimeout(async()=>{o=!0;try{await t(),e()}catch(i){N.P("Failed to execute callback",i),a()}},i),s=()=>{N.S("Cancel called"),self.clearTimeout(n),o||e()}}),cancel:s}}function se(t){const e=(new Date).getTime(),i=t&&t.notificationId||null;return{accumulatedDuration:0,appId:t.appId,lastActivatedTimestamp:e,lastDeactivatedTimestamp:null,notificationId:i,sessionKey:$t,startTimestamp:e,status:Wt}}async function ae(t){if(t.direct&&t.direct.enabled){const t=await Zt();if(t.length>0)return{type:$,notificationIds:[t[0].notificationId]}}if(t.indirect&&t.indirect.enabled){const e=60*t.indirect.influencedTimePeriodMin*1e3,i=new Date((new Date).getTime()-e).getTime(),n=await(async()=>(await zt.getAll("Outcomes.NotificationReceived")).map(t=>{return{appId:(e=t).appId,notificationId:e.notificationId,timestamp:e.timestamp};var e}))();if(N.S(`\tFound total of ${n.length} received notifications`),n.length>0){const e=t.indirect.influencedNotificationsLimit,s=function(t,e,i=!1,n=!0){const s=n?t:t.slice();return s.sort((t,n)=>{const s=e(t),a=e(n);return s>a?i?-1:1:s<a?i?1:-1:0}),s}(n,t=>t.timestamp,!0,!1),a=s.filter(t=>t.timestamp>=i).slice(0,e).map(t=>t.notificationId);N.S(`\tTotal of ${a.length} received notifications are within reporting window.`);const o=s.filter(t=>-1===a.indexOf(t.notificationId)).map(t=>t.notificationId);if(o.forEach(t=>zt.delete("Outcomes.NotificationReceived",t)),N.S(`\t${o.length} received notifications will be deleted.`),a.length>0)return{type:W,notificationIds:a}}}return t.unattributed&&t.unattributed.enabled?{type:F,notificationIds:[]}:{type:K,notificationIds:[]}}async function oe(t,e,i,n,s){n!==Kt&&(zt.put("Sessions",s),ce(),await V.T(t,e,i))}async function re(t,e,i,n,s,a){if(N.S("Finalize session",`started: ${new Date(n.startTimestamp)}`,`duration: ${n.accumulatedDuration}s`),s){N.S(`send on_focus reporting session duration -> ${n.accumulatedDuration}s`);const s=await ae(a);N.S("send on_focus with attribution",s),await V.N(t,e,i,n.accumulatedDuration,s)}await Promise.all([Yt(),qt("Outcomes.NotificationClicked")]),N.S("Finalize session finished",`started: ${new Date(n.startTimestamp)}`)}const ce=async()=>{const t=(await zt.getAll("SentUniqueOutcome")).map(t=>(t.sentDuringSession=null,zt.put("SentUniqueOutcome",t)));await Promise.all(t)},ue=async t=>{let e=[];try{e=await Zt()}catch(i){N.P("Database.getLastNotificationClickedForOutcomes",i)}return e.find(e=>e.appId===t)||null};function le(t,e){return t<=e?0:Math.floor((t-e)/1e3)}const de="GetWorkerVersion",fe="Subscribe",pe="SubscribeNew",we="notification.willDisplay",he="notification.clicked",be="notification.dismissed",ye="os.session.upsert",me="os.session.deactivate",ge="os.page_focused_request",ve="os.page_focused_response",_e="os.set_sw_logging";class Se{U;constructor(){this.U={}}A(t,e,i){const n={callback:e,onceListenerOnly:i},s=this.U[t.toString()];s?s.push(n):this.U[t.toString()]=[n]}M(t){return this.U[t.toString()]||[]}R(t){this.U[t.toString()]=null}$(){this.U={}}W(t,e){const i=this.U[t.toString()];if(null!=i)for(let n=i.length-1;n>=0;n--){i[n]===e&&i.splice(n,1)}}}class ke{F;U;constructor(t,e=new Se){this.F=t,this.U=e}K(t,e){this.U.A(t,e,!1)}L(t,e){this.U.A(t,e,!0)}V(t){t?this.U.R(t):this.U.$()}}class Ie extends ke{async H(){self.addEventListener("message",this.j.bind(this)),N.S("[Worker Messenger] Service worker is now listening for messages.")}j(t){const e=t.data;if(!e||!e.command)return;const i=this.U.M(e.command),n=[],s=[];N.S("[Worker Messenger] Service worker received message:",t.data);for(const a of i)a.onceListenerOnly&&n.push(a),s.push(a);for(let a=n.length-1;a>=0;a--){const t=n[a];this.U.W(e.command,t)}for(const a of s)a.callback.apply(null,[e.payload])}async q(t,e){const i=await self.clients.matchAll({type:"window",includeUncontrolled:!0});for(const n of i)N.S(`[Worker Messenger] [SW -> Page] Broadcasting '${t.toString()}' to window client ${n.url}.`),n.postMessage({command:t,payload:e})}async J(t,e,i){if(!i)throw new Error(`"${"windowClient"}" is empty`);N.S(`[Worker Messenger] [SW -> Page] Unicasting '${t.toString()}' to window client ${i.url}.`),i.postMessage({command:t,payload:e})}}class Pe{w3cEndpoint;w3cP256dh;w3cAuth;safariDeviceToken;static G(t){const e=new Pe;if(t&&(e.w3cEndpoint=new URL(t.endpoint),t.getKey)){let n=null;try{n=t.getKey("p256dh")}catch(i){}let s=null;try{s=t.getKey("auth")}catch(i){}if(n){const t=btoa(String.fromCharCode(...new Uint8Array(n)));e.w3cP256dh=t}if(s){const t=btoa(String.fromCharCode(...new Uint8Array(s)));e.w3cAuth=t}}return e}Y(t){t&&(this.safariDeviceToken=t)}B(){return{w3cEndpoint:this.w3cEndpoint?this.w3cEndpoint.toString():null,w3cP256dh:this.w3cP256dh,w3cAuth:this.w3cAuth,safariDeviceToken:this.safariDeviceToken}}static X(t){const e=new Pe;if(!t)return e;try{e.w3cEndpoint=new URL(t.w3cEndpoint)}catch(i){}return e.w3cP256dh=t.w3cP256dh,e.w3cAuth=t.w3cAuth,e.safariDeviceToken=t.safariDeviceToken,e}}const Oe=0,De=1;class Ce{F;Z;constructor(t,e){this.F=t,this.Z=e}async tt(t,e){t&&(t=Pe.X(t)),await this.et();const i=await ee();return i.deviceId="99999999-9999-9999-9999-999999999999",i.optedOut=!1,t?v()?i.subscriptionToken=t.safariDeviceToken:i.subscriptionToken=t.w3cEndpoint?t.w3cEndpoint.toString():null:i.subscriptionToken=null,await ie(i),"undefined"!=typeof OneSignal&&(OneSignal._sessionInitAlreadyRunning=!1),i}async et(){const{deviceId:t}=await ee();return!!t}async it(t,e){const i=await t.getSubscription();switch(e){case Oe:if(!i)break;i.options?N.S("[Subscription Manager] An existing push subscription exists and it's options is not null."):(N.S("[Subscription Manager] An existing push subscription exists and options is null. Unsubscribing from push first now."),await Ce.nt(i));break;case De:i&&await Ce.nt(i)}const[n,s]=await Ce.st(t,this.ot());await Ce.rt(s,n.expirationTime);return Pe.G(n)}ot(){let t;return t=y()===p?this.Z.onesignalVapidPublicKey:this.Z.vapidPublicKey,t?function(t){const e=(t+"=".repeat((4-t.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),i=atob(e),n=new Uint8Array(i.length);for(let s=0;s<i.length;++s)n[s]=i.charCodeAt(s);return n}(t).buffer:void 0}static async rt(t,e){const i=await ee();t&&(i.createdAt=(new Date).getTime()),i.expirationTime=e,await ie(i)}static async st(t,e){if(!e)throw new Error("Missing required 'applicationServerKey' to subscribe for push notifications!");const i={userVisibleOnly:!0,applicationServerKey:e};N.S("[Subscription Manager] Subscribing to web push with these options:",i);try{const e=await t.getSubscription();return[await t.subscribe(i),!e]}catch(n){if(n instanceof Error){N.I("[Subscription Manager] Couldn't re-subscribe due to applicationServerKey changing, unsubscribe and attempting to subscribe with new key.",n);const e=await t.getSubscription();return e&&await Ce.nt(e),[await t.subscribe(i),!0]}throw n}}static async nt(t){N.S("[Subscription Manager] Unsubscribing existing push subscription.");const e=await t.unsubscribe();return N.S(`[Subscription Manager] Unsubscribing existing push subscription result: ${e}`),e}}class xe extends Ce{async ct(t){return await this.ut(t)}async ut(t){const e=self.registration;if(!e.active&&y()!==p)throw new Error("SW not activated");const i=await e.pushManager.permissionState({userVisibleOnly:!0});if("denied"===i)throw O;if("prompt"===i)throw new Error("Permission not granted");return await this.it(e.pushManager,t)}}class Te{lt;dt;ft;constructor(t){var e,i;this.lt=t,this.dt=new xe(e=this,{safariWebId:(i=e.lt).safariWebId,appId:i.appId,vapidPublicKey:i.vapidPublicKey,onesignalVapidPublicKey:i.onesignalVapidPublicKey}),this.ft=new Ie(this)}}function Ne(t){return{notificationId:t.custom.i,title:t.title,body:t.alert,additionalData:t.custom.a,launchURL:t.custom.u,confirmDelivery:"y"===t.custom.rr,icon:t.icon,image:t.image,actionButtons:(e=t.o,e?.map(t=>({actionId:t.i,text:t.n,icon:t.p,launchURL:t.u}))),topic:t.tag,badgeIcon:t.badge};var e}class Be{async send(t){const e=await Jt(`webhooks.${t.event}`);if(!e)return;const i=await Jt("webhooks.cors"),n={method:"post",mode:"no-cors",body:JSON.stringify(t)};i&&(n.mode="cors",n.headers={"X-OneSignal-Event":t.event,"Content-Type":"application/json"}),N.S(`Executing ${t.event} webhook ${i?"with":"without"} CORS POST ${e}`,t),await fetch(e,n)}}class Ue{sender;constructor(t=new Be){this.sender=t}async click(t,e){const i=t.notification;return await this.sender.send({event:"notification.clicked",notificationId:i.notificationId,heading:i.title,content:i.body,additionalData:i.additionalData,actionId:t.result.actionId,url:t.result.url,subscriptionId:e})}async willDisplay(t,e){return await this.sender.send({event:"notification.willDisplay",notificationId:t.notificationId,heading:t.title,content:t.body,additionalData:t.additionalData,url:t.launchURL,subscriptionId:e})}async dismiss(t,e){return await this.sender.send({event:"notification.dismissed",notificationId:t.notificationId,heading:t.title,content:t.body,additionalData:t.additionalData,url:t.launchURL,subscriptionId:e})}}class Ae{static get wt(){return new Ue}static async ht(){const t=await self.registration.pushManager.getSubscription(),e=t?.endpoint;if(e)return async function(t){const e=await zt.getAll("subscriptions");for(const i of e)if(i.token===t)return i.id}(e)}static get ft(){return self.ft||(self.ft=new Ie(void 0)),self.ft}static bt(){self.addEventListener("activate",Ae.yt),self.addEventListener("push",Ae.gt),self.addEventListener("notificationclose",t=>t.waitUntil(Ae.vt(t))),self.addEventListener("notificationclick",t=>t.waitUntil(Ae._t(t))),self.addEventListener("pushsubscriptionchange",t=>{t.waitUntil(Ae.St(t))}),self.addEventListener("message",t=>{const e=t.data,i=e?.payload;switch(e?.command){case ye:N.S("[Service Worker] Received SessionUpsert",i),Ae.kt(t,i);break;case me:N.S("[Service Worker] Received SessionDeactivate",i),Ae.kt(t,i);break;default:return}}),N.S("Setting up message listeners."),setTimeout(()=>{Ae.ft.H(),Ae.It()},0)}static async Pt(){if(self.location.search){const t=self.location.search.match(/appId=([0-9a-z-]+)&?/i);if(t&&t.length>1){return t[1]}}const{appId:t}=await Xt();return t}static It(){Ae.ft.K(de,()=>{N.S("[Service Worker] Received worker version message."),Ae.ft.q(de,m)}),Ae.ft.K(fe,async t=>{const e=t;N.S("[Service Worker] Received subscribe message.");const i=new Te(e),n=await i.dt.ct(Oe),s=await i.dt.tt(n);Ae.ft.q(fe,s.B())}),Ae.ft.K(pe,async t=>{const e=t;N.S("[Service Worker] Received subscribe new message.");const i=new Te(e),n=await i.dt.ct(De),s=await i.dt.tt(n);Ae.ft.q(pe,s.B())}),Ae.ft.K(ve,async t=>{N.S("[Service Worker] Received response for AreYouVisible",t);const e=t.timestamp;self.clientsStatus?.timestamp===e&&(self.clientsStatus.receivedResponsesCount++,t.focused&&(self.clientsStatus.hasAnyActiveSessions=!0))}),Ae.ft.K(_e,async t=>{t.shouldLog?self.shouldLog=!0:self.shouldLog=void 0})}static gt(t){N.S(`Called onPushReceived(${JSON.stringify(t,null,4)}):`,t),t.waitUntil(Ae.Ot(t).then(async t=>{const e=[],i=[],n=await Ae.Pt();for(const s of t){N.S("Raw Notification from OneSignal:",s);const t=Ne(s);i.push(Qt(n,t)),e.push((async t=>{const e={notification:t};await Ae.ft.q(we,e).catch(t=>N.P(t));const i=await Ae.ht();return Ae.wt.willDisplay(t,i),Ae.Dt(t).then(()=>Ae.Ct(t)).catch(t=>N.P(t))}).bind(null,t))}return e.reduce((t,e)=>t.then(e),Promise.resolve())}).catch(t=>{N.S("Failed to display a notification:",t)}))}static async Ct(t){if(!t)return;if(!Ae.xt())return null;if(!t.confirmDelivery)return;const e=await Ae.Pt(),i=await this.ht();if(!!(!e||!t.notificationId))return;const n={player_id:i,app_id:e,device_type:k()};N.S(`Called sendConfirmedDelivery(${JSON.stringify(t,null,4)})`),await C(Math.floor(25*Math.random()*1e3)),await U.put(`notifications/${t.notificationId}/report_received`,n)}static xt(){return y()!==f}static async Tt(){return await self.clients.matchAll({type:"window",includeUncontrolled:!0})}static async Nt(t,e,i){if(e)await async function(t,e,i,n,s,a,o){const r=await Gt();if(!r){const n=se({appId:t}),s=await ue(t);return s&&(n.notificationId=s.notificationId),await zt.put("Sessions",n),void(await oe(t,e,i,a,n))}if(r.status===Wt)return void N.S("Session already active",r);if(!r.lastDeactivatedTimestamp)return void N.S("Session is in invalid state",r);const c=(new Date).getTime();if(le(c,r.lastDeactivatedTimestamp)<=n)return r.status=Wt,r.lastActivatedTimestamp=c,r.lastDeactivatedTimestamp=null,void(await zt.put("Sessions",r));await re(t,e,i,r,s,o);const u=se({appId:t});await zt.put("Sessions",u),await oe(t,e,i,a,u)}(i.appId,i.onesignalId,i.subscriptionId,i.sessionThreshold,i.enableSessionDuration,i.sessionOrigin,i.outcomesConfig);else{const e=await async function(t,e,i,n,s,a){const o=await Gt();if(!o)return void N.S("No active session found. Cannot deactivate.");const r=()=>re(t,e,i,o,s,a);if(o.status===Ft)return ne(r,n);if(o.status!==Wt)return void N.I(`Session in invalid state ${o.status}. Cannot deactivate.`);const c=(new Date).getTime(),u=le(c,o.lastActivatedTimestamp);o.lastDeactivatedTimestamp=c,o.accumulatedDuration+=u,o.status=Ft;const l=ne(r,n);return await zt.put("Sessions",o),l}(i.appId,i.onesignalId,i.subscriptionId,i.sessionThreshold,i.enableSessionDuration,i.outcomesConfig);e&&(self.cancel=e.cancel,t.waitUntil(e.promise))}}static async Bt(t,e){N.S("[Service Worker] refreshSession");const i=await this.Tt();if(e.isSafari)await Ae.Ut(t,i,e);else{const n=i.some(t=>t.focused);N.S("[Service Worker] hasAnyActiveSessions",n),await Ae.Nt(t,n,e)}}static async Ut(t,e,i){const n=(new Date).getTime();self.clientsStatus={timestamp:n,sentRequestsCount:0,receivedResponsesCount:0,hasAnyActiveSessions:!1};const s={timestamp:n};e.forEach(t=>{self.clientsStatus.sentRequestsCount++,t.postMessage({command:ge,payload:s})});const a=ne(async()=>{N.S("updateSessionBasedOnHasActive",self.clientsStatus),await Ae.Nt(t,self.clientsStatus.hasAnyActiveSessions,i),self.clientsStatus=void 0},.5);self.cancel=a.cancel,t.waitUntil(a.promise)}static kt(t,e){N.S("[Service Worker] debounceRefreshSession",e),self.cancel&&(self.cancel(),self.cancel=void 0);const i=ne(async()=>{await Ae.Bt(t,e)},1);self.cancel=i.cancel,t.waitUntil(i.promise)}static At(t){if(t)try{const e=new URL(t);if("localhost"===e.hostname||-1!==e.hostname.indexOf("192.168")||"127.0.0.1"===e.hostname||"https:"===e.protocol)return t;if("i0.wp.com"===e.hostname||"i1.wp.com"===e.hostname||"i2.wp.com"===e.hostname||"i3.wp.com"===e.hostname)return`https://${e.hostname}${e.pathname}`;return`https://i0.wp.com/${e.host+e.pathname}`}catch(e){N.P("ensureImageResourceHttps: ",e)}}static Mt(t){if(t&&(t.icon&&(t.icon=Ae.At(t.icon)),t.image&&(t.image=Ae.At(t.image)),t.actionButtons&&t.actionButtons.length>0))for(const e of t.actionButtons)e.icon&&(e.icon=Ae.At(e.icon))}static async Dt(t){N.S(`Called displayNotification(${JSON.stringify(t,null,4)}):`,t);const e=await Ae.Rt(),i=await Jt("defaultIcon"),n=await Jt("persistNotification"),s=await Ae.Pt();t.title=t.title?t.title:e,t.icon=t.icon?t.icon:i||void 0,Ae.Mt(t);const a={body:t.body,icon:t.icon,image:t.image,data:t,actions:(o=t.actionButtons,o?.map(t=>({action:t.actionId,title:t.text,icon:t.icon}))),tag:t.topic||s,requireInteraction:!1!==n,renotify:!0,badge:t.badgeIcon};var o;await self.registration.showNotification(t.title,a),this.Et()&&await C(1e3)}static Et(){const t=navigator.userAgentData,e="macOS"===t?.platform,i=!!t?.brands?.some(t=>"Chromium"===t.brand);return e&&i}static $t(t){return"javascript:void(0);"!==t&&"do_not_open"!==t&&(i="_osp=do_not_open",!((e=t)&&-1!==e.indexOf(i)));var e,i}static async vt(t){N.S(`Called onNotificationClosed(${JSON.stringify(t,null,4)}):`,t);const e=t.notification.data;Ae.ft.q(be,e).catch(t=>N.P(t));const i=await Ae.ht();Ae.wt.dismiss(e,i)}static async Wt(t,e){if(e){const i=t?.actionButtons?.find(t=>t.actionId===e);if(i?.launchURL&&""!==i.launchURL)return i.launchURL}if(t.launchURL&&""!==t.launchURL)return t.launchURL;const{defaultNotificationUrl:i}=await(async()=>{const t=await Jt("defaultUrl"),e=await Jt("defaultTitle"),i=await Jt("isPushEnabled"),n=await Jt("lastOptedIn");return{defaultNotificationUrl:t,defaultNotificationTitle:e,lastKnownPushEnabled:i,lastKnownPushId:await Jt("lastPushId")??void 0,lastKnownPushToken:await Jt("lastPushToken")??void 0,lastKnownOptedIn:n}})();return i||location.origin}static async _t(t){N.S(`Called onNotificationClicked(${JSON.stringify(t,null,4)}):`,t),t.notification.close();const e=t.notification.data;let i="exact",n="navigate";const s=await Jt("notificationClickHandlerMatch");s&&(i=s);const a=await Jt("notificationClickHandlerAction");a&&(n=a);const o=await Ae.Wt(e,t.action),r=Ae.$t(o),c=await Ae.Pt(),u=k(),l={notification:e,result:{actionId:t.action,url:o},timestamp:(new Date).getTime()};N.k("NotificationClicked",l);const d=(async t=>{try{const e=await Gt();if(e&&e.status===Wt)return;await(async(t,e)=>{await zt.put("Outcomes.NotificationClicked",function(t,e){return{appId:t,notificationId:e.notification.notificationId,timestamp:e.timestamp}}(t,e))})(c,t),e&&(e.notificationId=t.notification.notificationId,await zt.put("Sessions",e))}catch(e){N.P("Failed to save clicked notification.",e)}})(l),f=await this.ht(),p=Ae.Ft(c,f,l,u),w=await Ae.Tt();let h=!1;for(const y of w){const t=y.url;let e="";try{e=new URL(t).origin}catch(b){N.P("Failed to get the HTTP site's actual origin:",b)}let s=null;try{s=new URL(o).origin}catch(b){N.P("Failed parse launchUrl:",b)}if("exact"===i&&t===o||"origin"===i&&e===s){if(y.url===o||"focus"===n&&e===s){Ae.ft.J(he,l,y);try{y instanceof WindowClient&&await y.focus()}catch(b){N.P("Failed to focus:",y,b)}}else if(y instanceof WindowClient&&y.navigate){try{N.S("Client is standard HTTPS site. Attempting to focus() client."),y instanceof WindowClient&&await y.focus()}catch(b){N.P("Failed to focus:",y,b)}try{r?(N.S(`Redirecting HTTPS site to (${o}).`),await y.navigate(o)):N.S("Not navigating because link is special.")}catch(b){N.P("Failed to navigate:",y,o,b)}}else await Ae.Kt(o);h=!0;break}}return r&&!h&&await Ae.Kt(o),d&&await d,await p}static async Ft(t,e,i,n){const s=i.notification;if(!s.notificationId)return void console.error("No notification id, skipping networks calls to report open!");let a;t?a=U.put(`notifications/${s.notificationId}`,{app_id:t,player_id:e,opened:!0,device_type:n}):console.error("No app Id, skipping OneSignal API call for notification open!"),await Ae.wt.click(i,e),a&&await a}static async Kt(t){N.S("Opening notification URL:",t);try{return await self.clients.openWindow(t)}catch(e){return N.I(`Failed to open the URL '${t}':`,e),null}}static yt(t){N.k(`OneSignal Service Worker activated (version ${m})`),t.waitUntil(self.clients.claim())}static async St(t){N.S(`Called onPushSubscriptionChange(${JSON.stringify(t,null,4)}):`,t);const e=await Ae.Pt();if(!e)return;const i=await wt({appId:e},V.D);if(!i)return;const n=new Te(i);let s,a;{let i=(await ee()).deviceId;if(s=!!i,!s&&t.oldSubscription){i=await V.C(e,k(),t.oldSubscription.endpoint);const n=await ee();n.deviceId=i,await ie(n)}s=!!i}const o=t.newSubscription;if(o)a=Pe.G(o);else try{a=await n.dt.ct(De)}catch(r){}if(s||!!a){let t=null;"granted"!==Notification.permission?t=u:a||(t=l),await n.dt.tt(a,t)}else await zt.delete("Ids","userId"),await zt.delete("Ids","registrationId")}static Rt(){return new Promise(t=>{Promise.all([Jt("defaultTitle"),Jt("pageTitle")]).then(([e,i])=>{t(null!==e?e:null!=i?i:"")})})}static Ot(t){if(!t||!t.data)return Promise.reject("Missing event.data on push payload!");if(Ae.Lt(t.data)){N.S("Received a valid encrypted push payload.");const e=t.data.json();return Promise.resolve([e])}return Promise.reject(`Unexpected push message payload received: ${t.data}`)}static Lt(t){try{const e=t.json();return!!function(t){return"string"==typeof t?.custom?.i}(e)||(N.S("isValidPushPayload: Valid JSON but missing notification UUID:",e),!1)}catch(e){return N.S("isValidPushPayload: Parsing to JSON failed with:",e),!1}}}Ae.bt(),self.OneSignalWorker=Ae}();
//# sourceMappingURL=OneSignalSDK.sw.js.map
